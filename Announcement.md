## 公告栏配置

从3.1.x开始，增加了对公告API的支持

启用方法很简单，在客户端配置文件中添加：

```yaml
announcement_api: http://127.0.0.1/anno.txt
```

选项后面填写的是一个url，填好后，程序启动后就会使用ajax读取返回的内容。

这里不仅仅支持txt格式的公告，也同样支持html格式的公告。

但同样也有一个问题，因为我给前端暴露了nodejsAPI，所以在正式环境中一定要使用https协议来显示公告，否则一旦被劫持，可能会导致别有用心的人入侵系统。

### 搭建公告API

你可以选择在其它地方自行搭建公告API，如果你是计算机小白，可以参考下面的方法

（下面的方法是把公告内容和更新服务端整合到了一起，如果你喜欢，也可以单独在别的服务器上部署公告API）

<!-- tabs:start -->

#### **单文件服务端**

在单文件服务端的目录（`LittleServer-v1.2.exe`同级目录）下创建一个文件`anno.txt`，然后打开文件写上一些公告信息

然后打开客户端配置文件，新增一行

```yaml
announcement_api: http://127.0.0.1:8850/anno.txt
```

也就是说，把你配置项`api`后面的`index.yml`换成`anno.txt`然后填到这里就可以了

最后启动程序测试实际效果

#### **静态服务端**

在静态服务端的`updater`目录下创建一个文件`anno.txt`，然后打开文件写上一些公告信息

然后打开客户端配置文件，新增一行配置项

```yaml
announcement_api: http://127.0.0.1/anno.txt
```

这里的`announcement_api`的地址是和`api`是相同的，只不过把配置项`api`后面的`index.yml`换成`anno.txt`然后写到了这里，这样就能获取公告了

当然每次更新公告内容的话，也是需要重新上传一次的

最后启动程序测试实际效果

#### **PHP服务端**

在PHP服务端的目录下创建一个文件`anno.txt`，然后打开文件写上一些公告信息

然后打开客户端配置文件，新增一行配置项

```yaml
announcement_api: http://127.0.0.1/anno.txt
```

这里的`announcement_api`的地址是和`api`是相同的，只不过把配置项`api`后面的`index.yml`换成`anno.txt`然后写到了这里，这样就能获取公告了

最后启动程序测试实际效果

<!-- tabs:end -->

### 关于如何在公告栏里调用系统浏览器

如果需要点击公告栏上的某些按钮打开系统浏览器的话，请不要使用a标签打开，而是使用js代码，调用API`updaterApi.execute('start https://mcbbs.com')`的形式打开，否则会打开一个小窗口显示页面，大小什么的好像也调不了，挺不美观的

### 换行和乱码问题

如果遇到乱码的问题，请尝试用UTF-8保存公告文件

如果遇到换行失效的问题，请在公告文件内，使用`<pre></pre>`包裹公告内容，比如这样

```html
<pre>
【升级】12月14日负载均衡SLB升级通知

升级窗口：北京时间2021年12月14日 00:30 - 07:00
升级内容：华北2（北京）、华东1（杭州）、华北1（青岛）地域部分负载均衡SLB升级。
升级影响：升级期间部分负载均衡SLB 公网访问会有2~4次闪断(1秒内)，客户端重连可恢复，请在客户端中做好重连重试机制。受影响实例详见您的站内信和邮件，如果未收到升级短信/站内信/邮件则不受影响。


给您带来的不便敬请谅解，有任何问题，可点击联系我们进行咨询反馈
</pre>
```
