<!DOCTYPE html>
<html lang="cn">
<head>
    <meta charset="UTF-8">
    <title>Updater</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="description" content="Description">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css">
</head>
<body>
    <div id="app">Loading...</div>
    <script>
        window.$docsify = {
            name: 'UpdaterForMinecraft',
            repo: 'https://github.com/updater-for-minecraft/Docs',
            auto2top: true,
            loadNavbar: true,
            formatUpdated: '{MM}/{DD} {HH}:{mm}',
            topMargin: 90,
            tabs: {
                persist    : true,
                sync       : false,
                theme      : 'classic',
                tabComments: true,
                tabHeadings: true
            }
        }
    </script>
    <!-- Docsify v4 -->
    <script src="//cdn.jsdelivr.net/npm/docsify@4"></script>
    <!-- 图片缩放 -->
    <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/zoom-image.min.js"></script>
    <!-- 代码复制 -->
    <script src="//cdn.jsdelivr.net/npm/docsify-copy-code"></script>
    <!-- json高亮 -->
    <script src="//cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-json.min.js"></script>
    <!-- docsify-tabs (latest v1.x.x) -->
    <script src="https://cdn.jsdelivr.net/npm/docsify-tabs@1"></script>

    <script src="//cdn.jsdelivr.net/gh/innc11/VaComment@v1.3.5/index.js"></script>
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/innc11/VaComment@v1.3.5/index.css" />

    <!-- <script src="http://127.0.0.1:9981/index.js"></script>
	<link rel="stylesheet" type="text/css" href="http://127.0.0.1:9981/index.css" /> -->

    <script>

        console.log('VaComment v'+VaComment.version()+' ('+(VaComment.isProduction()?'prod':'dev')+')')

        var va = new VaComment({
            elementId: 'va-comment-widget',
            api: 'https://server.innc11.cn:4010',
            mailEnabled: true,
            websiteEnabled: false,
            language: {
                comment: '还有什么要补充的吗?\n支持Markdown格式，留下邮箱可以收到回复提醒',
                nick: '昵称',
                mail: '邮箱(会被保密，可选)',
                website: '网站',
            },

        });

        (function(){
            var defaultTitle = document.querySelector('title').innerHTML
            var plugin = function(hook) {
                hook.afterEach(function(html) {
                    var parser = new DOMParser()
                    var root = parser.parseFromString(html, 'text/html')
                    var dom = root.querySelectorAll('h1,h2,h3,h4,h5,h6')
                    if(dom.length > 0) {
                        setTimeout(() => {
                            document.querySelector('title').innerHTML = dom[0].innerText
                        }, 5);
                    } else {
                        document.querySelector('title').innerHTML = defaultTitle
                    }
                    return html;
                });
            }
            
            window.$docsify.plugins = window.$docsify.plugins.concat([plugin])
        })();

        (function(){
            var plugin = function(hook) {
                hook.afterEach(function(html) {
                    setTimeout(() => {
                        va.key = location.href.replace(location.origin, '').replace('#', '%23')
                        va.pageComment = document.querySelector('title').innerHTML
                        va.create()
                    }, 10);
                    return html + `<hr style="margin: 4rem 0 3rem 0;"/><div class="comment-tip">评论</div><div id="va-comment-widget">A</div>`;
                });

                hook.beforeEach(function(content) {
                    if(!va.isDestroyed()) {
                        va.destroy()
                    }

                    return content
                })
            }
            window.$docsify.plugins = window.$docsify.plugins.concat([plugin])
        })();
    </script>

    <style>
        #va-comment-widget {
            max-width: 800px;
            margin: 0 auto;
        }

        .comment-tip {
            padding: 5px;
            font-weight: 600;
            font-size: 1.8em;
            text-align: center;
            margin-bottom: 1rem;
        }
    </style>
</body>
</html>
