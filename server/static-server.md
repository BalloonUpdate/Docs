## 静态服务端安装教程

在使用静态服务端前，请确保你熟悉以下内容，否则不建议使用静态服务端：

1. JSON语法
2. YAML语法
3. 超文本传输协议基本知识（尤其是常见错误代码）
4. 对象存储服务商提供的命令行工具，比如腾讯coscli、阿里ossutil（如果你使用对象存储的话）

首先下载服务端zip包，将`静态服务端`解压出来到任何地方

果你要更新模组文件：复制Minecraft客户端中所有的模组文件到`res/.minecraft/mods/`里（目录请自行创建），注意是所有文件

如果你要更新其它文件，同样按上面的方法，复制到`res`目录里对应的路径的目录上（比如vexview的贴图复制到`res/.minecraft/vexview/textures/`下，其它文件同理）

编辑服务端配置文件`updater/index.json`，在`common_mode`和`once_mode`下写上所有要进行更新的目录的路径，比如要更新模组文件和vexview的贴图文件可以这样写

```json
// 路径分隔符只能使用正斜线，如果用反斜线出了问题请自行解决！
// 请避免在更新规则中包含[]方括号，会导致更新失败
{
    "update": "res",
    "common_mode": [
        ".minecraft/mods/*.jar",
        ".minecraft/vexview/textures/**"
    ],
    "once_mode": []
}
```

+ `update`选项一般不要修改，这个选项指明了实际要更新的文件存放在哪个文件夹里
+ `common_mode`和`once_mode`选项的具体用法和更多示例可以[点击这里](reference.md)

到这里就配置完毕了，可以上传到对象存储/自己服务器了。目前提供两种上传方式（上传工具）二选一：

1. [新的上传方式](tool-utos.md)（推荐新用户，支持对象存储和自由化部署（仅作为CLI工具使用））
2. [老的上传方式](tool-oss.md)（原对象存储小工具，适合老用户，支持对象存储、FTP、SFTP、FTPS）

---

由于静态服务端的环境限制，无法动态返回`res`目录的文件结构信息，因此这个数据必须进行预计算。预计算的结果会保存到有一个特有的文件`res.json`里

客户端完全依赖此文件去计算自身与服务端的文件差异，因此此文件必须时刻与`res`目录里的文件结构保持同步。否则客户端可能会出现离奇的404报错，调试起来非常麻烦

`res.json`文件由上传工具计算出来，并非手动创建。因此每次更新桶里的文件之后，都需要重新生成`res.json`文件且一并上传（无论上传到对象存储还是自由化部署都需要）

+ 如果是上传到对象存储，建议全程使用上传工具维护桶内文件，不建议单独手改，因为很容易造成`res`目录内容和`res.json`文件不一致，导致客户端报404错误
+ 如果是自由化部署，也请使用CLI工具生成/刷新`res.json`文件，并时刻保持`res`目录内容和`res.json`文件的同步

上传完成后，请在浏览器里访问`index.json`文件的URL，如果一切顺利，浏览器会显示`index.json`文件的内容。此步骤一定不要嫌麻烦而跳过，否则后面遇到问题会造成排查困难

---

注意所有参与更新文件的文件名中请不要包含下列字符，否则出现**服务端返回无法解码的数据**的错误请自己想办法：

[forbidden-chars.md](forbidden-chars.md ':include')

---

[for-xmcl.md](for-xmcl.md ':include')

## 后续维护

得益于软件的同步式更新架构，后续的客户端维护其实是非常简单的：

+ 给客户端新增文件：在服务端**添加**对应的文件，然后进行一次同步/上传，客户端那边就会同步更新
+ 删除客户端的文件：在服务端**删除**对应的文件，然后进行一次同步/上传，客户端那边就会同步更新
+ 更新客户端的文件：在服务端**替换**对应的文件，然后进行一次同步/上传，客户端那边就会同步更新

不仅仅是文件，文件夹也是和上面一样的更新逻辑。这样，服务端的内容，就会自动同步到客户端那边。如果没有按预期更新，请检查一下对应的文件/目录是否忘了添加更新规则。

## 常见问题

访问桶内文件出现403错误：检查桶的权限是否设置为**公有读私有写**

找不到`res.json`文件：请仔细看上方的教程，不要自作聪明跳过步骤

