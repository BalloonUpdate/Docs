# 小工具使用教程

目前支持以下服务商的一键上传功能（对小白友好）

1. 阿里云对象存储（推荐）
2. 腾讯云对象存储（推荐）
3. FTP/SFTP

> 如果使用上述列表的服务商，则不用手动生成校验文件

如果你需要的上传方式不在上述列表，或者需要定制性更强、更灵活的部署方式，请选择下方的**Custom**（主要是大佬用户）

<!-- tabs:start -->

## **阿里/腾讯对象存储**

### 1. 准备工作

1. 同时解压主程序`Deployer.exe`和配置文件`config.json`
2. 打开配置文件`config.json`并编辑，然后保存退出
3. 将`静态服务端`目录拖到`Deployer.exe`上松开，就会开始上传（`静态服务端`可以改成任意文件名）

一些需要注意的地方：

1. 首次上传会删除桶内所有文件，请注意备份，建议单独创建一个桶

### 2. 配置文件讲解

小工具`1.6`以后为每个服务商都添加了单独的配置信息（配置隔离），只需要填写**你需要的**那一家服务商的信息就好了（小工具`1.5.x`版本请忽略）

```yaml
# 服务提供商，阿里云填写aliyun，腾讯云填写tencent
service_provider: ""

# 上传之前是否跳过生成校验文件的阶段（不生成校验文件就直接上传文件）
# 如果不知道我在说什么，请保持默认的false
# (小工具1.6以后已改名为upload_without_hashing)
skip_hashing_before_uploading: false

# 桶名，存储桶的名字，这个一般是创建的时候自己填写的名字
# (小工具1.6以后已改名为bucket_name)
bucket: ""

# 别名access_id，用于API验证。建议使用子账户来提高安全性。
secret_id: ""

# 别名access_key，用于API验证。建议使用子账户来提高安全性。
secret_key: ""

# 桶所在的地区，阿里云一般以oss-cn-开头，腾讯云一般以ap-开头
region: ""
```

## **FTP/SFTP**

在使用FTP上传方式之前，请务必备份根目录下的**所有文件**，避免错误的设置导致**误删**已有文件

### 0.使用限制

1. 因为一些原因，**SFTP模式下**无法校验服务端证书，请自行确保服务端的证书是有效的

2. 因FTP协议限制，无法直接返回文件的hash用以计算文件差异，在每次上传完成后会将远程文件目录结构保存到`ftp.cache.json`中，借此机制可以快速对比文件差异，实现增量上传，如果删除此文件，会进行一次全量上传，请自行判断何时清理缓存文件

3. 因FTP协议限制，无法直接返回文件的hash用以计算文件差异，对文件内容的对比完全依赖于FTP服务端所返回的**文件修改时间**和**文件大小**，请确保服务端能正常返回这些信息，否则会导致新文件的内容无法正常地上传

### 1. 准备工作

1. 同时解压主程序`Deployer.exe`和配置文件`config.json`
2. 打开配置文件`config.json`并编辑，然后保存退出
3. 将`静态服务端`目录拖到`Deployer.exe`上松开，就会开始上传（`静态服务端`可以改成任意文件名）

一些需要注意的地方：

1. 首次上传会删除根目录所有文件，请一定要注意备份文件

### 2. 配置文件讲解

```yaml
# FTP服务器主机
host: 127.0.0.1

# FTP服务器端口，通常是21
port: 21

# FTP用户名
user: ab

# FTP用户密码
password: ab

# 根目录路径，/代表上传到根目录，/ab/代表上传到ab子目录里
# 必须以/结尾！！
base_path: /

# 时区偏移，仅在服务器返回的时区不正确时使用
# 如果一直出现增量上传失效请尝试设置为8（中国为东八区）
timezone_offset: 0

# 启用TLS加密
secure: false

# 在登录后执行prop_p命令，建议保持默认
prot_p: false
```

## **Custom**

修改好客户端要用来更新的文件以后，并不能直接上传到自己的服务器，需要将`目录校验文件`**更新后**也一并上传

目录校验文件是一个以`.json`结尾的文件，放在其对应的目录旁边，通常情况下`hotupdate`目录和`resources`目录各有一个以`.json`文件结尾的校验文件

客户端完全依赖目录校验文件去计算自身与服务端的文件差异，如果文件夹内的文件有变动，就需要重新生成一次，否则客户端无法感知到服务端的文件修改

> 目录校验文件包含了目录里所有文件结构和信息，也包括子目录结构，每个文件的校验和大小等信息。感兴趣可以亲自打开文件看一下结构。

生成校验文件，需要解压之前下载的小工具:`Deployer.exe`（注意只解压主程序，不要解压配置文件）

**具体用法**：将要生成的目录直接拖到`Deployer.exe`可执行文件上松开，就会在目录旁生成一个同名`.json`文件

在生成好校验文件以后，请将新的校验文件和要用来给mc更新的文件一起上传到自己的服务器上就可以了

<!-- tabs:end -->

