## 小工具使用教程

目前支持以下服务商的一键上传功能

+ 阿里云对象存储（推荐）
+ 腾讯云对象存储（推荐）
+ FTP/SFTP

!> 注意：无论使用什么方式上传，建议在上传之前备份所有现有的文件

### 使用方法

1. 编辑配置文件`config.yml`，然后保存退出
3. 运行`上传.bat`，开始上传
4. 上传完成后，直接关掉窗口就可以

### 配置文件

下面是一个完整的配置文件示例

```yaml
# 是否在上传时显示调试数据
debug: false

# 是否跳过生成校验文件阶段，不要修改此选项！
# 如果调整为true则只会上传文件，不会重新生成校验文件
upload_only: false

# 上传完成后，是否不自动退出
# 设置为false后会直接退出，不会显示"任意键退出.."字样
show_any_key_to_exit: false

# 上传到哪里？
# 腾讯云请填写tencent
# 阿里云请填写aliyun
# FTP请填写ftp
service_provider: tencent

# 腾讯云需要填写此部分
tencent:
  # 桶名
  bucket: 
  # 访问秘钥的id
  secret_id: 
  # 访问秘钥的key
  secret_key: 
  # 桶的地域
  region: ap-nanjing
  
  # 缓存文件的文件名。用来实现增量上传
  # 此文件会存储到桶里（而不是本地），删除此文件可以进行一次全量上传
  # 只支持放置在桶的根目录（也就是说这里只能填写文件名不能填写一个路径）
  cache_file: .cache.yml

  # 按文件名自动添加http headers
  header_rules:
    # 正则表达式(按相对路径匹配，此路径不包含要上传的文件夹本身)
    - pattern: '.gz$'
    # 添加的http headers
      headers:
        Content-Encoding: gzip
  
# 阿里云需要填写此部分
aliyun:
  # 桶名
  bucket: 
  # 访问秘钥的id
  access_id: 
  # 访问秘钥的key
  access_key: 
  # 桶的地域
  region: oss-cn-chengdu.aliyuncs.com
  
  # 缓存文件的文件名。用来实现增量上传
  # 此文件会存储到桶里（而不是本地），删除此文件可以进行一次全量上传
  # 只支持放置在桶的根目录（也就是说这里只能填写文件名不能填写一个路径）
  cache_file: .cache.yml

  # 按文件名自动添加http headers
  header_rules:
    # 正则表达式(按相对路径匹配，此路径不包含要上传的文件夹本身)
    - pattern: '.gz$'
    # 添加的http headers
      headers:
        Content-Encoding: gzip

# FTP需要填写此部分
ftp:
  host: 127.0.0.1
  port: 21
  user: ab
  password: ab
  
  # 上传到哪个路径，支持子目录，默认是根目录，这里必须以/开头，结尾不做要求
  base_path: /
  
  # 缓存文件的文件名。用来实现增量上传
  # 此文件会存储到FTP服务器上（而不是本地），删除此文件可以进行一次全量上传
  # 只支持放置在根目录（也就是说这里只能填写文件名不能填写一个路径）
  cache_file: .cache.yml
  
  # 启用TLS加密（SFTP）
  secure: false
  
  # 高级参数，登录后是否立即发送prot_p命令
  prot_p: false
```

!>  如果是部署到对象存储服务，务必将桶的权限设置为**公共读**，否则无法是访问的！

### FTP注意事项

因为一些原因，**SFTP模式下**无法校验服务端证书（请自行确保证书是可信的）

v3.1.1版本开始不再依赖服务端返回的修改时间和文件大小等数据，增量上传的功能由**缓存文件**实现，该文件存储与FTP服务端的根路径，如果删除该文件，就会进行一次全量上传。

### 手动部署/手动上传

如果不想使用小工具的一键上传功能，可以选择自己手动上传，但需要在每次上传之前，重新生成一次`目录校验文件`

目录校验文件是一个与目录同名的`.yml`结尾的文件，放在其对应的目录旁边

#### 为什么要使用目录校验文件?

因为客户端完全依赖目录校验文件去计算自身与服务端的文件差异，如果文件夹内的文件有变动，就需要重新生成一次，否则客户端无法感知到服务端的文件修改

目录校验文件包含了目录里所有文件结构和信息（子目录结构、每个文件的校验和大小等）感兴趣可以亲自打开文件看一下结构。

#### 生成目录校验文件

生成校验文件可以使用小工具来生成（删除掉小工具的配置文件，只保留一个主程序，小工具就会进入**校验文件生成模式**，而不是上传模式）

具体操作方法是把`res`目录拖到小工具上松开，就会生成一个同名`.yml`文件，但建议写个批处理来进行操作，更加简单

在生成好校验文件以后，请将校验文件和源文件一起上传到自己的服务器上



