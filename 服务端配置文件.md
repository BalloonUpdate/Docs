# 服务端配置文件server.json

这个文件决定了updater如何按你的想法来进行工作

这里有一个栗子，是用来更新客户端所有模组文件的（也是最常见的需求）

```json
{
    "version": "2.6",
    "mode_a": true,
    "command_before_exit": "",
    "match_all_regexes" : false,
    "regexes": [
        "\\.minecraft/mods/[^/]+\\.jar"
    ]
}
```

## 参数：mode_a

updater的工作模式

默认是`A`模式，可以填写`false`来调整为`B`模式，但推荐使用`A`模式

**A模式：** 指定需要更新/同步的文件夹，这个文件夹和服务器保持同步

**B模式：** 只更新服务器已有的文件，其它的文件不会进行任何操作

## 参数：command_before_exit

一行命令

这个命令会在所有更新完毕后，updater退出之前被执行，默认留空表示不启用这个功能，可以用来在更新完毕后打开启动器

如果需要更高阶的用法，请参考Windows的shell命令

## 参数：match_all_regexes

是否需要匹配**所有**正则表达式

默认为`false`，建议保持默认值

如果想任意**匹配一条表达式**就会进行更新请设置为`false`

如果想**全部的表达式都匹配**才会更新的话就需要设置为`true`

（开发者们应该都知道`and`和`or`的关系，这里同理）

## 参数：regexes

设置具体要更新的目录路径（相对路径）

> 2.6.5终于不再只支持正则了，也支持纯文本模式

如果你只需要简单更新一下一些目录，并不想使用复杂正则进行高级匹配，

请在对应规则字符串前加上一个@符号，这条规则会被视为纯文本规则（你可以叫它小白模式）

```json
{
    "version": "2.6",
    "mode_a": true,
    "command_before_exit": "",
    "match_all_regexes" : false,
    "regexes": [
        "@.minecraft/mods",
        "@.minecraft/vexview"
    ]
}
```

加上@之后直接写目录的路径就好啦（推荐小白这样写），就不用考虑什么正则表达式转义的影响了，但是同时也无法使用通配符等特性了，是否需要加上@请根据需要填写

如果需要使用高级的正则表达式请参考下面的部分，也可以看看[服务端配置文件示例](服务端配置文件示例.md)

---

纯文本规则可以普通正则规则在同一个文件里混合使用，比如下面的例子和上面的例子是等效的

```json
{
    "version": "2.6",
    "mode_a": true,
    "command_before_exit": "",
    "match_all_regexes" : false,
    "regexes": [
        "\\.minecraft/mods",
        "@.minecraft/vexview"
    ]
}
```

不同模式下，regexes的功能会发生变化：

- **A模式下**：正则表达式匹配的文件会被**更新**，没有匹配的不会进行任何操作

- **B模式下：**正则表达式匹配的文件会被**删除**，没有匹配会**正常地**进行更新(B模式使用场景并不多)

有些地方需要注意：

1. 请注意反斜杠`\`的转义问题（如果使用VsCode，语法错误会有红色高亮）
2. 如果值为空列表（即 `[]` ），A模式下所有的文件夹都不会被更新，B模式下不会删除任何文件
3. 请注意半角点`.` 的转义和正则表达式本身的转义字符影响
4. 路径分隔符用正斜线`/`表示。目录路径开头和末尾都没有`/`
5. 正则表达式可能会指向目录，也可能会指向文件，请用有无`.`（后缀名）判断是文件还是目录（无后缀的文件暂时无法区分）
6. 如果使用B模式，请注意在每次更新新版mod时请确保新旧文件名一致，不然软件会视为两个文件，导致客户端新旧文件同时存在（重复）

[服务端配置文件示例](服务端配置文件示例.md)